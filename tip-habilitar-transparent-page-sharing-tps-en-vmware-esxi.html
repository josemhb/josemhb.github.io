<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>[TIP] Habilitar Transparent Page Sharing (TPS) en VMware ESXi  - Josemhb Blog</title><meta name="description" content="¡Hola a todos! tras unos meses con mucho trabajo y pocas horas de descanso, por el nacimiento de mi segundo hijo, he vuelto a sacar tiempo para escribir varios artículos."><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://josemhb.github.io/tip-habilitar-transparent-page-sharing-tps-en-vmware-esxi.html"><link rel="alternate" type="application/atom+xml" href="https://josemhb.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://josemhb.github.io/feed.json"><meta property="og:title" content="[TIP] Habilitar Transparent Page Sharing (TPS) en VMware ESXi "><meta property="og:image" content="https://josemhb.github.io/media/posts/3/server1.jpg"><meta property="og:image:width" content="5740"><meta property="og:image:height" content="3827"><meta property="og:site_name" content="Josemhb Blog"><meta property="og:description" content="¡Hola a todos! tras unos meses con mucho trabajo y pocas horas de descanso, por el nacimiento de mi segundo hijo, he vuelto a sacar tiempo para escribir varios artículos."><meta property="og:url" content="https://josemhb.github.io/tip-habilitar-transparent-page-sharing-tps-en-vmware-esxi.html"><meta property="og:type" content="article"><link rel="stylesheet" href="https://josemhb.github.io/assets/css/style.css?v=fd1c61900b807bfe9bfd41bce96eed57"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://josemhb.github.io/tip-habilitar-transparent-page-sharing-tps-en-vmware-esxi.html"},"headline":"[TIP] Habilitar Transparent Page Sharing (TPS) en VMware ESXi ","datePublished":"2015-11-11T18:29","dateModified":"2024-03-31T18:38","image":{"@type":"ImageObject","url":"https://josemhb.github.io/media/posts/3/server1.jpg","height":3827,"width":5740},"description":"¡Hola a todos! tras unos meses con mucho trabajo y pocas horas de descanso, por el nacimiento de mi segundo hijo, he vuelto a sacar tiempo para escribir varios artículos.","author":{"@type":"Person","name":"Jose Manuel Hernandez","url":"https://josemhb.github.io/authors/jose-manuel-hernandez/"},"publisher":{"@type":"Organization","name":"Jose Manuel Hernandez"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://josemhb.github.io/">Josemhb Blog</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://josemhb.github.io/home" target="_self">Home</a></li><li><a href="https://josemhb.github.io/post" target="_self">Posts</a></li></ul></nav><div class="search"><div class="search__overlay js-search-overlay"><div class="search__overlay-inner"><button class="search__close js-search-close" aria-label="Close">Close</button></div></div><button class="search__btn js-search-btn" aria-label="Search"><svg role="presentation" focusable="false"><use xlink:href="https://josemhb.github.io/assets/svg/svg-map.svg#search"/></svg></button></div></header><main><article class="post"><div class="hero"><figure class="hero__image hero__image--overlay"><img src="https://josemhb.github.io/media/posts/3/server1.jpg" srcset="https://josemhb.github.io/media/posts/3/responsive/server1-xs.jpg 300w, https://josemhb.github.io/media/posts/3/responsive/server1-sm.jpg 480w, https://josemhb.github.io/media/posts/3/responsive/server1-md.jpg 768w, https://josemhb.github.io/media/posts/3/responsive/server1-lg.jpg 1024w, https://josemhb.github.io/media/posts/3/responsive/server1-xl.jpg 1360w, https://josemhb.github.io/media/posts/3/responsive/server1-2xl.jpg 1600w" sizes="(max-width: 1600px) 100vw, 1600px" loading="eager" height="3827" width="5740" alt="server"><figcaption>server</figcaption></figure><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2015-11-11T18:29">November 11, 2015</time></div><h1>[TIP] Habilitar Transparent Page Sharing (TPS) en VMware ESXi </h1><div class="post__meta post__meta--author"><a href="https://josemhb.github.io/authors/jose-manuel-hernandez/" class="feed__author">Jose Manuel Hernandez</a></div></div></header></div><div class="wrapper post__entry"><div data-original-attrs="{&quot;style&quot;:&quot;&quot;}">¡Hola a todos! tras unos meses con mucho trabajo y pocas horas de descanso, por el nacimiento de mi segundo hijo, he vuelto a sacar tiempo para escribir varios artículos. Este es un pequeño TIP para recordaros algo sobre <strong>TPS</strong> de <strong>ESXi</strong>.</div><p><br><br></p><div class="separator" data-original-attrs="{&quot;style&quot;:&quot;&quot;}"><a data-original-attrs="{&quot;data-original-href&quot;:&quot;https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiQPEmPKuy0dAwFabdjIl1ErvEKEs5haRFMK22rJM1m3NelWpt-pbjFj1G1kRy-niZPKxaXXDWvJ9FYyGBK1NM6Qr2MERA_Of9-BLh78bQhiOo-oWEsmLBDFBcmAcd-K3hqFuu-F14cO42k/s1600/tps.JPG&quot;,&quot;style&quot;:&quot;&quot;}" href="https://www.blogger.com/u/1/#"><img loading="lazy" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiQPEmPKuy0dAwFabdjIl1ErvEKEs5haRFMK22rJM1m3NelWpt-pbjFj1G1kRy-niZPKxaXXDWvJ9FYyGBK1NM6Qr2MERA_Of9-BLh78bQhiOo-oWEsmLBDFBcmAcd-K3hqFuu-F14cO42k/s1600/tps.JPG" border="0" data-original-height="258" data-original-width="316" data-is-external-image="true"></a></div><p> </p><div data-original-attrs="{&quot;style&quot;:&quot;&quot;}">Como sabéis, <strong>TPS (Transparent Page Sharing)</strong> es un mecanismo que nos permite ahorrar en el uso de memoria de cada host ESXi guardando en memoria física solo bloques únicos, en muchos casos este ahorro es bastante significativo.</div><div data-original-attrs="{&quot;style&quot;:&quot;&quot;}"> </div><div data-original-attrs="{&quot;style&quot;:&quot;&quot;}">A partir de la [<a data-original-attrs="{&quot;data-original-href&quot;:&quot;http://kb.vmware.com/selfservice/search.do?cmd=displayKC&amp;docType=kc&amp;docTypeID=DT_KB_1_1&amp;externalId=2080735&quot;}" href="https://www.blogger.com/u/1/#">KB2080735</a>] por motivos de seguridad se decidió deshabilitar por defecto TPS en las posteriores versiones de ESXi. Estos cambios están relacionados con una investigación académica reciente que aprovecha transparente Sharing Página (TPS) para obtener acceso no autorizado a los datos en memoria en determinadas condiciones.</div><div data-original-attrs="{&quot;style&quot;:&quot;&quot;}"> </div><div data-original-attrs="{&quot;style&quot;:&quot;&quot;}">En algunas instalaciones normales que he estado revisando me he dado cuenta de que no estaba habilitado TPS. En muchos casos y en entornos controlados, si este pequeño problema de seguridad no te afecta, recuerda habilitar TPS en tu plataforma vSphere para optimizar el uso de memoria en tu ESXi.</div><p><br>Puedes hacerlo de dos modos:<br><br><strong>Por GUI</strong>:<br><br>1 – Entrar con el cliente vsphere y seleccionar el host ESXi<br>2 – Seleccionar la ficha configuración y luego configuración avanzada (advanced settings)<br>3 – Haga clic en **Mem**<br>4 – Buscar la variable **Mem.ShareForceSalting** y establezca el valor en **1** para habilitarlo.<br>5 – Pulsar aceptar<br>6 – Migrar todas las máquinas a otro host para poder reiniciar el ESXi sobre el que hemos realizado el cambio.<br>7 – Reiniciar<br><br><strong>Vía Powercli (si tienes muchos esxi):</strong><br><br></p><div data-original-attrs="{&quot;style&quot;:&quot;&quot;}">Si tienes muchos hosts puede que el método anterior sea poco óptimo y lento, para ello VMware ha creado un script (pshare-salting.ps1) que puedes lanzar desde PowerCLI y aplicar este cambio sobre todos los hosts:</div><p><br>*.\pshare-salting.ps1 [vcenter IP/hostname] -s*<br><br><strong>script:</strong></p><pre class="screen"># Configure pshare salting options
# - Enables / Disables the salting. 
#

$reboot = 0
$enable = 0
$disable = 0
if ($args.count -gt 0) {
   $vCenter = $args[ 0 ]
   for ( $i = 1; $i -lt $args.count; $i++ ) {
      if ($args[ $i ] -eq "-s") {
         $enable = 1
      }
      if ($args[ $i ] -eq "-o") {
         $disable = 1
      }
   }
   # override
   if ($enable -eq 1) {
      $disable = 0
   }
}

# we should specify either -s or -o
if ($enable -eq 0 ) {
  if ($disable -eq 0 ) {
     Write-Host "Usage: ./pshare-salting.ps1  &lt;-s/-o&gt;"
     Write-Host "-s: turn-on pshare salting (default)"
     Write-Host "-o: turn-off pshare salting\n"
     return
   }
}

Connect-VIServer $vCenter

$esxHosts = Get-VMHost | Sort Name
foreach($esx in $esxHosts){
      # Revert ShareScaGHz to default
      Set-VMHostAdvancedConfiguration -VMHost $esx -Name Mem.ShareScanGHz -Value 4 -Confirm:$false    
   if ($enable -eq 1) {
      Write-Host "Enabling PageShare Salting on $esx"
      $val = (Get-VMHostAdvancedConfiguration -VMHost $esx -Name Mem.ShareForceSalting).Values
      Set-VMHostAdvancedConfiguration -VMHost $esx -Name Mem.ShareForceSalting -Value 2 -Confirm:$false    
   } else {
      Write-Host "Disabling PageShare Salting on $esx"
      $val = (Get-VMHostAdvancedConfiguration -VMHost $esx -Name Mem.ShareForceSalting.).Values
      Set-VMHostAdvancedConfiguration -VMHost $esx -Name Mem.ShareForceSalting -Value 0 -Confirm:$false      
   }
}
</pre><p>Con esto tendrás todos tus hosts con TPS habilitado.<br><br>Hasta la próxima.<br><br></p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on March 31, 2024</p><ul class="post__tag"><li><a href="https://josemhb.github.io/tags/vmware/">VMware</a></li></ul><div class="post__share"></div><div class="post__bio bio"><div><h3 class="bio__name"><a href="https://josemhb.github.io/authors/jose-manuel-hernandez/" rel="author">Jose Manuel Hernandez</a></h3></div></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-next"><a href="https://josemhb.github.io/reutilizar-una-ip-flotante-en-openstack.html" class="post__nav-link" rel="next"><span>Next</span> Reutilizar una IP flotante en Openstack </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://josemhb.github.io/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav><div class="post__related related"><div class="wrapper"><h2 class="h5 related__title">You should also read:</h2><article class="related__item"><div class="feed__meta"><time datetime="2018-08-03T10:42" class="feed__date">August 3, 2018</time></div><h3 class="h1"><a href="https://josemhb.github.io/solucionar-conflictos-con-vibs-actualizando-de-vmware-esxi-55-a-65.html">Solucionar conflictos con vibs actualizando de VMware ESXi 5.5 a 6.5</a></h3></article></div></div></main><footer class="footer"><div class="footer__social"></div><div class="footer__copyright"><p>Copyright © José M. Hernández 2024</p></div><button onclick="backToTopFunction()" id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg><use xlink:href="https://josemhb.github.io/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script defer="defer" src="https://josemhb.github.io/assets/js/scripts.min.js?v=f47c11534595205f20935f0db2a62a85"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 10,doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>