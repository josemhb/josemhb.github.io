{
    "version": "https://jsonfeed.org/version/1",
    "title": "Josemhb Blog",
    "description": "",
    "home_page_url": "https://josemhb.github.io",
    "feed_url": "https://josemhb.github.io/feed.json",
    "user_comment": "",
    "author": {
        "name": "Jose Manuel Hernandez"
    },
    "items": [
        {
            "id": "https://josemhb.github.io/reutilizar-una-ip-flotante-en-openstack.html",
            "url": "https://josemhb.github.io/reutilizar-una-ip-flotante-en-openstack.html",
            "title": "Reutilizar una IP flotante en Openstack",
            "summary": "Hoy quería compartir un problema que he tenido en una instalación de Openstack. Como sabéis, Openstack Neutron asigna IPs flotantes de manera consecutiva y hasta que no se consuman todas&hellip;",
            "content_html": "<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\">Hoy quería compartir un problema que he tenido en una instalación de Openstack. Como sabéis, Openstack Neutron asigna IPs flotantes de manera consecutiva y hasta que no se consuman todas las IPs del pool no empieza a reciclar las IPs en desuso. En mi caso para evitar modificar la configuración de firewalls, DNS y demás necesitaba rehusar esta misma dirección IP para una instancia.</div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\"><br>Tras desasignar la IP y eliminarse esta del Tenant, necesitaba asignarla de nuevo, a continuación os detallo como lo he realizado.</div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\"> </div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\">Esta configuración se hace a través de la base de datos de nuestra infraestructura así que vamos a entrar desde un nodo de control a MySQL:</div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\"> </div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\">\n<pre class=\"screen\">root@node-11:~# mysql -u root\nWelcome to the MySQL monitor.  Commands end with ; or \\g.\nYour MySQL connection id is 525603\nServer version: 5.6.16-2~u14.04+mos2-log (Ubuntu), wsrep_25.5.rXXXX\n\nCopyright (c) 2000, 2014, Oracle and/or its affiliates. All rights reserved.\n\nOracle is a registered trademark of Oracle Corporation and/or its\naffiliates. Other names may be trademarks of their respective\nowners.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.</pre>\n</div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\"> </div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\">Usamos la BD de Neutron:</div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\">\n<pre class=\"screen\">mysql&gt; use neutron;\nReading table information for completion of table and column names\nYou can turn off this feature to get a quicker startup with -A\n\nDatabase changed</pre>\n</div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\"> </div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\">Identificamos los pools de IPs que tenemos:</div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\">\n<pre class=\"screen\">mysql&gt; select * from ipavailabilityranges;\n+--------------------------------------+-------------+--------------+\n| allocation_pool_id                   | first_ip    | last_ip      |\n+--------------------------------------+-------------+--------------+\n| 1fbbfa85-bc2e-447a-8ddb-8436bb783706 | 10.50.1.48  | 10.50.1.254  |\n| 3271e259-2767-4234-816b-101ecf56e152 | 10.50.2.5   | 10.50.2.254  |\n| 5ebbce7f-21d6-43a6-be65-5165347eb29d | 10.20.15.35 | 10.20.15.254 |\n| d3f1f050-b3c7-4ac5-9318-33c194018e45 | 10.20.10.59 | 10.20.11.254 |\n| db102e26-4697-4957-8e68-0c24f656d1fd | 10.50.4.9   | 10.50.4.254  |\n+--------------------------------------+-------------+--------------+\n5 rows in set (0.00 sec)</pre>\n</div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\"> </div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\">Establecemos dentro del pool en cuestión la IP que queremos que sea asignada:</div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\">\n<pre class=\"screen\">mysql&gt; UPDATE ipavailabilityranges SET first_ip = '10.20.10.24' \nWHERE allocation_pool_id='d3f1f050-b3c7-4ac5-9318-33c194018e45';\nQuery OK, 1 row affected (0.00 sec)\nRows matched: 1  Changed: 1  Warnings: 0</pre>\n</div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\"> </div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\">&gt;NOTA: Es importante tener control sobre la asignación de IPs en la infraestructura y mientras realicemos este proceso no se soliciten IPs flotantes.</div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\">Asociamos la IP flotante a nuestra instancia:</div>\n<div class=\"separator\" data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\"><a data-original-attrs=\"{&quot;data-original-href&quot;:&quot;https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhYkrznMrOy0ql5_OCDfLlSS7eYEYdhKB6oX8QseCBjIkfX3GQscXUISSI8_tZjOnrzi0oUepzrwYA-LAPDOhg1GYhRSepAc9apGd71bP6IFmI6MaAzQA-VyrAiETsY6sf8aWwVcDZKIOuF/s1600/ip_floating-1024x311.png&quot;,&quot;style&quot;:&quot;&quot;}\" href=\"https://www.blogger.com/u/1/#\"><img loading=\"lazy\" src=\"https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhYkrznMrOy0ql5_OCDfLlSS7eYEYdhKB6oX8QseCBjIkfX3GQscXUISSI8_tZjOnrzi0oUepzrwYA-LAPDOhg1GYhRSepAc9apGd71bP6IFmI6MaAzQA-VyrAiETsY6sf8aWwVcDZKIOuF/s640/ip_floating-1024x311.png\" width=\"640\" height=\"194\" border=\"0\" data-original-height=\"311\" data-original-width=\"1024\" data-is-external-image=\"true\"></a></div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\"> </div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\"> </div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\">Devolvemos la primera IP disponible a la que estaba establecida inicialmente para no tener problemas:</div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\">\n<pre class=\"screen\">mysql&gt; UPDATE ipavailabilityranges SET first_ip = '10.20.10.59' \nWHERE allocation_pool_id='d3f1f050-b3c7-4ac5-9318-33c194018e45';\nQuery OK, 1 row affected (0.00 sec)\nRows matched: 1  Changed: 1  Warnings: 0</pre>\n</div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\"> </div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\">Con este workaround podremos disponer de una IP reciclada de nuevo en nuestra instancia.</div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\"> </div>",
            "image": "https://josemhb.github.io/media/posts/4/server2.jpg",
            "author": {
                "name": "Jose Manuel Hernandez"
            },
            "tags": [
                   "Openstack"
            ],
            "date_published": "2016-01-15T22:37:00+01:00",
            "date_modified": "2024-03-31T18:37:57+02:00"
        },
        {
            "id": "https://josemhb.github.io/tip-habilitar-transparent-page-sharing-tps-en-vmware-esxi.html",
            "url": "https://josemhb.github.io/tip-habilitar-transparent-page-sharing-tps-en-vmware-esxi.html",
            "title": "[TIP] Habilitar Transparent Page Sharing (TPS) en VMware ESXi ",
            "summary": "¡Hola a todos! tras unos meses con mucho trabajo y pocas horas de descanso, por el nacimiento de mi segundo hijo, he vuelto a sacar tiempo para escribir varios artículos.",
            "content_html": "<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\">¡Hola a todos! tras unos meses con mucho trabajo y pocas horas de descanso, por el nacimiento de mi segundo hijo, he vuelto a sacar tiempo para escribir varios artículos. Este es un pequeño TIP para recordaros algo sobre <strong>TPS</strong> de <strong>ESXi</strong>.</div>\n<p><br><br></p>\n<div class=\"separator\" data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\"><a data-original-attrs=\"{&quot;data-original-href&quot;:&quot;https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiQPEmPKuy0dAwFabdjIl1ErvEKEs5haRFMK22rJM1m3NelWpt-pbjFj1G1kRy-niZPKxaXXDWvJ9FYyGBK1NM6Qr2MERA_Of9-BLh78bQhiOo-oWEsmLBDFBcmAcd-K3hqFuu-F14cO42k/s1600/tps.JPG&quot;,&quot;style&quot;:&quot;&quot;}\" href=\"https://www.blogger.com/u/1/#\"><img loading=\"lazy\" src=\"https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiQPEmPKuy0dAwFabdjIl1ErvEKEs5haRFMK22rJM1m3NelWpt-pbjFj1G1kRy-niZPKxaXXDWvJ9FYyGBK1NM6Qr2MERA_Of9-BLh78bQhiOo-oWEsmLBDFBcmAcd-K3hqFuu-F14cO42k/s1600/tps.JPG\" border=\"0\" data-original-height=\"258\" data-original-width=\"316\" data-is-external-image=\"true\"></a></div>\n<p> </p>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\">Como sabéis, <strong>TPS (Transparent Page Sharing)</strong> es un mecanismo que nos permite ahorrar en el uso de memoria de cada host ESXi guardando en memoria física solo bloques únicos, en muchos casos este ahorro es bastante significativo.</div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\"> </div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\">A partir de la [<a data-original-attrs=\"{&quot;data-original-href&quot;:&quot;http://kb.vmware.com/selfservice/search.do?cmd=displayKC&amp;docType=kc&amp;docTypeID=DT_KB_1_1&amp;externalId=2080735&quot;}\" href=\"https://www.blogger.com/u/1/#\">KB2080735</a>] por motivos de seguridad se decidió deshabilitar por defecto TPS en las posteriores versiones de ESXi. Estos cambios están relacionados con una investigación académica reciente que aprovecha transparente Sharing Página (TPS) para obtener acceso no autorizado a los datos en memoria en determinadas condiciones.</div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\"> </div>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\">En algunas instalaciones normales que he estado revisando me he dado cuenta de que no estaba habilitado TPS. En muchos casos y en entornos controlados, si este pequeño problema de seguridad no te afecta, recuerda habilitar TPS en tu plataforma vSphere para optimizar el uso de memoria en tu ESXi.</div>\n<p><br>Puedes hacerlo de dos modos:<br><br><strong>Por GUI</strong>:<br><br>1 – Entrar con el cliente vsphere y seleccionar el host ESXi<br>2 – Seleccionar la ficha configuración y luego configuración avanzada (advanced settings)<br>3 – Haga clic en **Mem**<br>4 – Buscar la variable **Mem.ShareForceSalting** y establezca el valor en **1** para habilitarlo.<br>5 – Pulsar aceptar<br>6 – Migrar todas las máquinas a otro host para poder reiniciar el ESXi sobre el que hemos realizado el cambio.<br>7 – Reiniciar<br><br><strong>Vía Powercli (si tienes muchos esxi):</strong><br><br></p>\n<div data-original-attrs=\"{&quot;style&quot;:&quot;&quot;}\">Si tienes muchos hosts puede que el método anterior sea poco óptimo y lento, para ello VMware ha creado un script (pshare-salting.ps1) que puedes lanzar desde PowerCLI y aplicar este cambio sobre todos los hosts:</div>\n<p><br>*.\\pshare-salting.ps1 [vcenter IP/hostname] -s*<br><br><strong>script:</strong></p>\n<pre class=\"screen\"># Configure pshare salting options\n# - Enables / Disables the salting. \n#\n\n$reboot = 0\n$enable = 0\n$disable = 0\nif ($args.count -gt 0) {\n   $vCenter = $args[ 0 ]\n   for ( $i = 1; $i -lt $args.count; $i++ ) {\n      if ($args[ $i ] -eq \"-s\") {\n         $enable = 1\n      }\n      if ($args[ $i ] -eq \"-o\") {\n         $disable = 1\n      }\n   }\n   # override\n   if ($enable -eq 1) {\n      $disable = 0\n   }\n}\n\n# we should specify either -s or -o\nif ($enable -eq 0 ) {\n  if ($disable -eq 0 ) {\n     Write-Host \"Usage: ./pshare-salting.ps1  &lt;-s/-o&gt;\"\n     Write-Host \"-s: turn-on pshare salting (default)\"\n     Write-Host \"-o: turn-off pshare salting\\n\"\n     return\n   }\n}\n\nConnect-VIServer $vCenter\n\n$esxHosts = Get-VMHost | Sort Name\nforeach($esx in $esxHosts){\n      # Revert ShareScaGHz to default\n      Set-VMHostAdvancedConfiguration -VMHost $esx -Name Mem.ShareScanGHz -Value 4 -Confirm:$false    \n   if ($enable -eq 1) {\n      Write-Host \"Enabling PageShare Salting on $esx\"\n      $val = (Get-VMHostAdvancedConfiguration -VMHost $esx -Name Mem.ShareForceSalting).Values\n      Set-VMHostAdvancedConfiguration -VMHost $esx -Name Mem.ShareForceSalting -Value 2 -Confirm:$false    \n   } else {\n      Write-Host \"Disabling PageShare Salting on $esx\"\n      $val = (Get-VMHostAdvancedConfiguration -VMHost $esx -Name Mem.ShareForceSalting.).Values\n      Set-VMHostAdvancedConfiguration -VMHost $esx -Name Mem.ShareForceSalting -Value 0 -Confirm:$false      \n   }\n}\n</pre>\n<p>Con esto tendrás todos tus hosts con TPS habilitado.<br><br>Hasta la próxima.<br><br></p>",
            "image": "https://josemhb.github.io/media/posts/3/server1.jpg",
            "author": {
                "name": "Jose Manuel Hernandez"
            },
            "tags": [
                   "VMware"
            ],
            "date_published": "2015-11-11T18:29:00+01:00",
            "date_modified": "2024-03-31T18:38:16+02:00"
        }
    ]
}
